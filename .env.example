# =============================================================================
# Captive Portal Configuration
# =============================================================================
# Copy this file to .env and fill in your values

# Server Configuration
PORT=3000
SESSION_SECRET=generate-a-random-32-character-string-here
DB_PATH=/app/data/captive_portal.db

# Logging level (error, warn, info, debug)
LOG_LEVEL=info

# Session timeout redirect - where to send users when session expires
SESSION_TIMEOUT_REDIRECT=http://your-captive-portal.local/

# =============================================================================
# Google OAuth Configuration
# =============================================================================
# 1. Go to https://console.cloud.google.com/
# 2. Create a new project or select existing
# 3. Enable Google+ API
# 4. Go to Credentials → Create Credentials → OAuth client ID
# 5. Select "Web application"
# 6. Add authorized redirect URI: http://your-domain:3000/auth/google/callback
# 7. Copy Client ID and Client Secret below

GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-client-secret
CALLBACK_URL=http://your-domain:3000/auth/google/callback

# =============================================================================
# Nextcloud CardDAV Configuration
# =============================================================================
# Used for phone + birthdate verification and contact creation
# 
# URL Format: https://your-nextcloud.com/remote.php/dav/addressbooks/users/USERNAME/contacts/
# 
# Create an app password in Nextcloud:
# 1. Go to Settings → Security → Devices & sessions
# 2. Create new app password
# 3. Use that password below (NOT your main password)

CARDDAV_URL=https://nextcloud.example.com/remote.php/dav/addressbooks/users/admin/contacts/
CARDDAV_USERNAME=admin
CARDDAV_PASSWORD=your-nextcloud-app-password

# =============================================================================
# Home Assistant Configuration
# =============================================================================
# Used for approval notifications and device tracking
#
# Create a long-lived access token:
# 1. Go to your Home Assistant profile
# 2. Scroll down to "Long-Lived Access Tokens"
# 3. Create a new token
# 4. Copy the token below

HOME_ASSISTANT_URL=http://192.168.1.100:8123
HOME_ASSISTANT_TOKEN=your-long-lived-access-token

# =============================================================================
# OPNsense Configuration (Optional)
# =============================================================================
# Integrates with OPNsense captive portal to manage MAC whitelist
#
# How it works:
# 1. When a user is approved, their MAC is added to the zone's "Allowed MAC Addresses"
# 2. When access is revoked, their MAC is removed from the whitelist
# 3. The captive portal is reconfigured after each change
#
# Create API credentials in OPNsense:
# 1. Go to System → Access → Users
# 2. Create or edit a user with admin privileges
# 3. Scroll down to "API keys" and click "+"
# 4. Save the key and secret (secret is only shown once!)
# 5. The user needs access to the Captive Portal module
#
# Zone ID:
# - Go to Services → Captive Portal → Zones
# - The Zone ID is shown in the "zoneid" column (usually 0 for first zone)
#
# URL should include port if using non-standard HTTPS port (e.g., :8443)
#
# SSL Verification:
# - By default, self-signed certificates are allowed (common for OPNsense)
# - Set OPNSENSE_VERIFY_SSL=true to enforce certificate validation
#
# ARP Polling:
# - Polls OPNsense ARP table to check if tracked devices are online
# - OPNSENSE_ARP_POLL_INTERVAL: seconds between polls (default: 60)

OPNSENSE_URL=https://192.168.1.1:8443
OPNSENSE_API_KEY=your-api-key
OPNSENSE_API_SECRET=your-api-secret
OPNSENSE_ZONE_ID=0
OPNSENSE_VERIFY_SSL=false
OPNSENSE_ARP_POLL_INTERVAL=60
OPNSENSE_SYNC_INTERVAL=60

# =============================================================================
# Device Presence and Session Configuration
# =============================================================================

# Device offline timeout (seconds) - how long after last_seen a device is considered offline
DEVICE_OFFLINE_TIMEOUT=30

# Session purge settings
SESSION_PURGE_HOURS=24
SESSION_MAX_AGE_HOURS=72

# Success redirect URL - where to redirect after successful login (leave empty to stay on success page)
SUCCESS_REDIRECT_URL=

# =============================================================================
# Security Configuration
# =============================================================================

# Maximum failed authentication attempts before blocking a MAC address
# Blocked MACs cannot attempt authentication until unblocked by admin
MAX_FAILED_ATTEMPTS=3

# Support contact info - shown when users fail authentication
WIFI_ADMIN_NAME=Shreyas
WIFI_SUPPORT_MESSAGE=No matching contact found. Please talk to ${WIFI_ADMIN_NAME} about getting WiFi access.
NODE_ENV=production